{% load wagtailcore_tags %}
{% load wagtailimages_tags %}
{% load utilities %}

{% image post.story_image fill-300x240 as post_image %}

<div class="card list {{post.content_type.model}}">
  <a href="{{post.url}}">
    <div class="card__image{% if not post.story_image %} no-image{%endif%}">
      <img src="{{post_image.url}}" class="fade-in-image" onload="this.classList.add('loaded');"/>
    </div>
    </a>
  <div class="card__text">
    <a href="{{post.url}}">
      <label class="card__text__date margin-top-0 block">{{post.date|date:"M. jS, Y"}}</label>
      <h3 class="card__text__title bold block">{{post.title}}</h3>
    </a>
    <label class="card__text__authors link subtitle">
      {% for author in post.post_author.all %}<a href="{{author.url}}">{{author.first_name}} {{author.last_name}}</a>
      {% if forloop.counter == post.authors.all|length|add:"-1" and post.authors.all|length > 2 %}<span class="punc">, &</span>
      {% elif forloop.counter == post.authors.all|length|add:"-1" %}<span class="punc">&nbsp;&</span>
      {% elif forloop.counter != post.authors.all|length %}<span class="punc">,</span>{% endif %}
      {% endfor %}
    </label>
    <a href="{{post.url}}">
      <label class="card__text__program caption margin-bottom-0 block">{{post.parent_programs.all.0.title}} {{post.content_type}}</label>
    </a>
  </div>

</div>
